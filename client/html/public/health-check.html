<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backend Health Check - শব্দ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;700&display=swap"
        rel="stylesheet">
    <!-- Theme CSS -->
    <link rel="stylesheet" href="css/auth-theme.css">
    <!-- Health Check CSS -->
    <link rel="stylesheet" href="css/health-check.css">
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Theme JS - This must be loaded before any other scripts that use theming -->
    <script type="text/javascript" src="javascripts/theme.js"></script>
</head>

<body class="health-page health-check">
    <div class="container">
        <h1>বাংলা অভিধান - Backend হেলথ চেক</h1>

        <div class="status">
            <span class="status-indicator loading"></span>
            <span id="status-text">চেকিং...</span>
        </div>

        <div id="details" class="details auth-hidden"></div>

        <div class="home-link">
            <a href="index.html">← হোম পেজে ফিরে যান</a>
        </div>

        <button id="refresh-btn" class="button mt-3">রিফ্রেশ</button>

        <div class="theme-selector">
            <p>থিম পরিবর্তন করুন:</p>
            <select id="themeSelector" class="form-control">
                <option value="green">সবুজ (ডিফল্ট)</option>
                <option value="dark">ডার্ক</option>
                <option value="blue">নীল</option>
                <option value="light">লাইট</option>
            </select>
        </div>
        
        <!-- Add footer similar to other pages -->
        <footer class="footer mt-3">
            <div class="footer-content">
                <p class="copyright">© ২০২৫ শব্দ</p>
                <p class="version">সংস্করণ ০.৮</p>
                <div class="footer-links">
                    <a href="https://github.com/tkr22777/shobdo" target="_blank">গিটহাব</a>
                    <span class="separator">•</span>
                    <a href="/" id="aboutLink">পরিচিতি</a>
                    <span class="separator">•</span>
                    <a href="#" id="themeToggle">ভা-ব</a>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Function to check the backend health
        function checkBackendHealth() {
            const healthCheckRoute = "/api/v1/health";

            $.ajax({
                type: "GET",
                url: healthCheckRoute,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                timeout: 1000, // 1 second timeout
                success: function (data, status, jqXHR) {
                    console.log("Backend health check successful:", data);

                    // Update status indicator and text
                    $('.status-indicator').removeClass('loading').addClass('healthy');
                    $('#status-text').text('Backend সচল আছে');

                    // Display details if available
                    if (data) {
                        let detailsHtml = '<h3>বিস্তারিত তথ্য:</h3>';

                        if (typeof data === 'object') {
                            detailsHtml += '<ul>';
                            for (const [key, value] of Object.entries(data)) {
                                detailsHtml += `<li><strong>${key}:</strong> ${value}</li>`;
                            }
                            detailsHtml += '</ul>';
                        } else {
                            detailsHtml += `<p>${data}</p>`;
                        }

                        $('#details').html(detailsHtml).removeClass('auth-hidden');
                    }
                },
                error: function (jqXHR, status, error) {
                    console.log("Backend health check failed:", error);

                    // Update status indicator and text
                    $('.status-indicator').removeClass('loading').addClass('unhealthy');
                    $('#status-text').text('Backend সচল নেই');

                    // Display error details
                    let errorDetails = '<h3>ত্রুটির বিবরণ:</h3>';
                    errorDetails += `<p>স্ট্যাটাস: ${jqXHR.status} ${jqXHR.statusText}</p>`;
                    if (error) {
                        errorDetails += `<p>ত্রুটি: ${error}</p>`;
                    }

                    $('#details').html(errorDetails).removeClass('auth-hidden');
                }
            });
        }

        // Run the health check when the page loads
        $(document).ready(function () {
            // Slight delay to show the loading state
            setTimeout(checkBackendHealth, 500);

            // Set up refresh button
            $('#refresh-btn').click(function () {
                // Reset status to loading
                $('.status-indicator').removeClass('healthy unhealthy').addClass('loading');
                $('#status-text').text('চেকিং...');
                $('#details').addClass('auth-hidden');

                // Run the health check again
                setTimeout(checkBackendHealth, 500);
            });
            
            // Theme management is now handled entirely by theme.js
            // No duplicate event handlers needed here
        });
    </script>
</body>

</html>