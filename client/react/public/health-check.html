<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>হেলথ চেক — শব্দ</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Source+Serif+4:ital,opsz,wght@0,8..60,400;0,8..60,600;1,8..60,400&family=Noto+Serif+Bengali:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/health-check.css">
</head>

<body>

    <header class="hc-header">
        <a href="/" class="hc-logo">শব্দ</a>
        <span class="hc-title">হেলথ চেক</span>
    </header>

    <main class="hc-main">
        <div class="hc-card">
            <h1 class="hc-heading">Backend স্ট্যাটাস</h1>

            <div class="hc-status" id="statusRow">
                <span class="hc-dot loading" id="statusDot"></span>
                <span class="hc-status-text" id="statusText">যাচাই করা হচ্ছে…</span>
            </div>

            <div class="hc-details" id="details"></div>

            <div class="hc-actions">
                <button class="hc-btn" id="refreshBtn">পুনরায় যাচাই</button>
                <a href="/" class="hc-btn hc-btn-ghost">← হোমে ফিরুন</a>
            </div>
        </div>
    </main>

    <script>
        function checkHealth() {
            var dot  = document.getElementById('statusDot');
            var text = document.getElementById('statusText');
            var details = document.getElementById('details');

            dot.className  = 'hc-dot loading';
            text.textContent = 'যাচাই করা হচ্ছে…';
            details.innerHTML = '';
            details.style.display = 'none';

            fetch('/api/v1/health', { headers: { 'Accept': 'application/json' } })
                .then(function(res) {
                    return res.json().then(function(data) { return { ok: res.ok, data: data }; });
                })
                .then(function(result) {
                    if (result.ok) {
                        dot.className  = 'hc-dot healthy';
                        text.textContent = 'Backend সচল আছে ✓';
                    } else {
                        dot.className  = 'hc-dot unhealthy';
                        text.textContent = 'Backend সচল নেই';
                    }
                    if (result.data && typeof result.data === 'object') {
                        var rows = Object.entries(result.data).map(function(kv) {
                            return '<tr><th>' + kv[0] + '</th><td>' + kv[1] + '</td></tr>';
                        }).join('');
                        details.innerHTML = '<table class="hc-table">' + rows + '</table>';
                        details.style.display = 'block';
                    }
                })
                .catch(function(err) {
                    dot.className  = 'hc-dot unhealthy';
                    text.textContent = 'Backend সচল নেই';
                    details.innerHTML = '<p class="hc-error">' + err.message + '</p>';
                    details.style.display = 'block';
                });
        }

        document.getElementById('refreshBtn').addEventListener('click', checkHealth);
        setTimeout(checkHealth, 300);
    </script>
</body>

</html>
